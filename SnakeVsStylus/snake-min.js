$(document).ready(function(){function nt(){u="menu";if(typeof update_loop!="undefined")clearInterval(update_loop);update_loop=setInterval(rt,60)}function rt(){var e;if(window.wiiu){e=window.wiiu.gamepad.update();if(!e.isEnabled||!e.isDataValid){e=null}}else if(E){window.location.assign("/nowiiu.html")}if(!e){e=new ct}if(i>0)i--;if(e.tpTouch==1&&e.tpValidity==0){at(e.contentX,e.contentY)}if(u=="menu"&&U){ot()}if(u=="play"){t.fillStyle="#9ec806";t.fillRect(0,0,s,o);L++;if(L>=k){L=0;var n=new gt(m[0].x+A,m[0].y+O);if(!J){if(n.x==0||n.x==l-1||n.y==0||n.y==c-1){u="over"}}if(n.getIndex(d)!=-1){u="over"}else if(n.getIndex(m)!=-1){u="over"}if(u!="over"){if(n.getIndex(v)!=-1){v.splice(n.getIndex(v),1);C++;b+=3}m.unshift(n);if(m.length>=b)m.pop()}}var r=new Date;_=r.getTime()-M.getTime();_=Math.min(_,D);if(_>H*(B+1)){B++;N=Math.min(P,N+4);C=Math.min(P,C+4);tt.push(new bt("Ammo UP",75));if(k>1){k=Math.ceil(k/2);tt.push(new bt("Speed &",75))}}t.fillStyle="#9ec806";t.fillRect(0,0,h,o);t.fillStyle="black";t.fillRect(s-p,0,p,o);t.fillStyle="black";t.fillRect(h-f,0,f,o);t.fillStyle="black";t.fillRect(h,0,s-h,p);t.fillStyle="black";t.fillRect(h,o-p,s-h,p);t.fillStyle="black";t.fillRect(h+l*a,0,s,o);for(var g=0;g<d.length;g++){t.fillStyle="black";t.fillRect(h+p+d[g].x*a,p+d[g].y*a,a,a)}for(var g=0;g<m.length;g++){t.fillStyle="black";var y=h+p+m[g].x*a;var S=p+m[g].y*a;t.fillRect(y,S,a,a);if(g!=0&&g!=m.length-1){t.fillStyle="#9ec806";if(g%2==0){t.fillRect(y,S+2*f,f,f)}else{t.fillRect(y+f*2,S,f,f)}}else if(g==m.length-1&&g>0){if(m[g-1].x<m[g].x){orientation="l"}else if(m[g-1].x>m[g].x){orientation="r"}else{if(m[g-1].y<m[g].y){orientation="u"}else{orientation="d"}}if(m[g].x==0&&m[g-1].x==l-1){orientation="l"}else if(m[g].x==l-1&&m[g-1].x==0){orientation="r"}else if(m[g].y==0&&m[g-1].y==c-1){orientation="u"}else if(m[g].y==c-1&&m[g-1].y==0){orientation="d"}if(orientation=="l"){t.fillStyle="#9ec806";t.fillRect(y+f,S,3*f,f);t.fillRect(y+2*f,S+f,2*f,f);t.fillRect(y+3*f,S+2*f,f,f)}else if(orientation=="r"){t.fillStyle="#9ec806";t.fillRect(y,S,3*f,f);t.fillRect(y,S+f,a/2,f);t.fillRect(y,S+2*f,a/4,f)}else if(orientation=="u"){t.fillStyle="#9ec806";t.fillRect(y,S+f,f,f);t.fillRect(y,S+2*f,2*f,f);t.fillRect(y,S+3*a/4,3*f,f)}else if(orientation=="d"){t.fillStyle="#9ec806";t.fillRect(y,S,3*f,f);t.fillRect(y,S+f,2*f,f);t.fillRect(y,S+2*f,f,f)}}}for(var g=0;g<v.length;g++){t.fillStyle="black";var y=h+p+v[g].x*a;var S=p+v[g].y*a;t.fillRect(y+f,S,2*f,a);t.fillRect(y,S+f,a,2*f);t.fillStyle="#9ec806";t.fillRect(y+f,S+f,f,f)}for(var g=0;g<et.length;g++){et[g].draw()}t.fillStyle="black";t.font=""+a*2+"px c64_basicregular";t.textAlign="center";t.fillText("x "+N,X/2+V,c*a*.475+X/2-f);t.fillText("x "+C,X/2+V,c*a*.225+X/2-f);var y=V+3*f;var S=c*a*.225-6*f;t.fillRect(y+f*2,S,2*f*2,a*2);t.fillRect(y,S+f*2,a*2,2*f*2);t.fillStyle="#9ec806";t.fillRect(y+f*2,S+f*2,f*2,f*2);t.fillStyle="black";var S=c*a*.475-6*f;t.fillRect(y,S,a*2,a*2);var S=c*a*.75-6*f;for(var g=0;g<8;g++){t.fillRect(y+g*f,S+g*f,f,f);t.fillRect(y+(7-g)*f,S+g*f,f,f)}if(!J){t.fillStyle="black";t.fillRect(h,0,l*a,a);t.fillRect(h,(c-1)*a,l*a,a);t.fillRect(h,0,a,c*a);t.fillRect((l-1)*a+h,0,a,c*a)}for(var g=0;g<tt.length;g++){tt[g].duration--;if(tt[g].duration<0){tt.splice(g,1);g--;continue}t.fillStyle="black";t.font=""+2*a+"px c64_basicregular";t.textAlign="center";t.fillText(tt[g].message,h/2,(c-1-g)*a)}t.fillStyle="black";t.font=""+2*a+"px c64_basicregular";t.textAlign="left";t.fillText(dt(_),a*1.25,a*1.5);if(w){vt();t.fillRect(s-a/2,0,a/2,o)}}if(u=="over"&&!z){t.fillStyle="#9ec806";t.strokeStyle="black";t.lineWidth=f;t.fillRect(f*50.5,f*20.5,f*100,f*35);t.strokeRect(f*50.5,f*20.5,f*100,f*35);t.fillStyle="black";t.textAlign="center";t.font=""+3*a+"px c64_basicregular";t.fillText("Game Over",f*100,f*30);t.font=""+2*a+"px c64_basicregular";t.fillText("Snake survived for "+pt(_),f*100,f*40);et=G;for(var g=0;g<et.length;g++){et[g].draw()}vt();t.fillRect(s-a/2,0,a/2,o);z=true}if(u=="howto"&&!W){t.fillStyle="#9ec806";t.fillRect(0,0,s,o);t.fillStyle="black";t.textAlign="center";t.font=""+4*a+"px c64_basicregular";t.fillText("How To Play",s*.5,o*.1);et=Y;for(var g=0;g<et.length;g++){et[g].draw()}t.fillRect(7*a,2.75*a,a*7,a*4);t.fillRect(10*a,7.5*a,5*f,3*a);t.fillStyle="#9ec806";t.fillRect(10*a+2*f,7.5*a+f,f,3*f);t.fillRect(10*a+f,7.5*a+2*f,3*f,f);t.fillRect(10*a+2*f,9.5*a,f,f);t.fillRect(10*a+2*f,10*a,f,f);t.fillRect(7*a,2.75*a,f*2,f);t.fillRect(7*a,2.75*a,f,f*2);t.fillRect(14*a-2*f,2.75*a,f*2,f);t.fillRect(14*a-f,2.75*a,f,f*2);t.fillRect(7*a,6.25*a,f,f*2);t.fillRect(7*a,6.5*a,f*2,f);t.fillRect(14*a-2*f,6.5*a,f*2,f);t.fillRect(14*a-f,6.25*a,f,f*2);t.fillRect(8*a,3.25*a,5*a,2.75*a);t.fillStyle="black";for(var g=0;g<6;g++){t.fillRect(10.5*a+g*f,4.75*a-g*f,f,f)}t.fillStyle="black";t.textAlign="left";t.font=""+4*a+"px c64_basicregular";t.fillText("P1",a*3,5*a);t.fillText("P2",a*3,10*a);t.font=""+2*a+"px c64_basicregular";t.fillText("Use the Touch Screen to",a*16,3.5*a);t.fillText("Place Apples",a*17,4.5*a);t.fillText("Place Blocks",a*17,5.5*a);t.fillText("Erase apples and blocks",a*17,6.5*a);t.fillText("Use the D-Pad to",a*16,a*8.5);t.fillText("Avoid the onslaught",a*17,a*9.5);t.fillText("Survive for as long as you can",a*17,a*10.5);t.fillText("* Tap icons on left to choose item to place",a*3,a*12);t.fillText("* Block/apple placement is limited by ammo count",a*3,a*13);t.fillText("* There is a 'safe zone' around the snake's head",a*3,a*14);t.fillText("* Snake speed and ammo count increase over time",a*3,a*15);t.fillText("* Pressing other buttons may affect browser",a*3,a*16);vt();t.fillRect(s-a/2,0,a/2,o);W=true}}function it(){M=new Date;y=Z[0].selected;k=12-3*(Z[1].selected+1);N=5*(Z[2].selected+1);C=N;while(m.length>0){m.pop()}m.push(new gt(5,5));while(d.length>0){d.pop()}while(v.length>0){v.pop()}while(tt.length>0){tt.pop()}b=5;u="play";A=1;O=0;H=15e3;B=0;z=false;et=K;et[0].select();et[0].onClick()}function st(){i=10;u="menu";et=Q;U=true;W=false}function ot(){t.fillStyle="#9ec806";t.fillRect(0,0,s,o);t.fillStyle="black";t.font=""+4*a+"px c64_basicregular";t.textAlign="center";t.fillText("Snake vs. Stylus",s*.5,o*.1);t.textAlign="right";t.font=""+2*a+"px c64_basicregular";t.fillText("Beta",s-a,o-a);for(var e=0;e<et.length;e++){et[e].draw()}for(var e=0;e<Z.length;e++){Z[e].draw()}t.font=""+2*a+"px c64_basicregular";t.textAlign="center";t.fillText("WiiMote",l*a,c*a*.2);t.fillText("Orientation",l*a,c*a*.25);t.fillText("Wrap-Around",l*a,c*a*.55);t.font=""+3*a+"px c64_basicregular";t.fillText("How To",30.5*a,17*a);t.fillText("Play",30.5*a,19*a);t.fillRect((l-3.5)*a,c*a*.3+f,5*f,12*f);t.fillRect((l+1)*a+f,c*a*.35,12*f,5*f);t.fillStyle="#9ec806";t.fillRect((l-3.5)*a+2*f,c*a*.3+2*f,f,3*f);t.fillRect((l-3.5)*a+f,c*a*.3+3*f,3*f,f);t.fillRect((l-3.5)*a+2*f,c*a*.3+9*f,f,f);t.fillRect((l-3.5)*a+2*f,c*a*.3+11*f,f,f);t.fillRect((l+1)*a+3*f,c*a*.35+f,f,3*f);t.fillRect((l+1)*a+2*f,c*a*.35+2*f,3*f,f);t.fillRect((l+1)*a+9*f,c*a*.35+2*f,f,f);t.fillRect((l+1)*a+11*f,c*a*.35+2*f,f,f);t.fillStyle="black";if(J){t.font=""+4*a+"px c64_basicregular";t.fillText("X",38*a,c*a*.75-X/2)}vt();t.fillRect(s-a/2,0,a/2,o)}function ut(t){if(i==0){var n=e.getBoundingClientRect();var r=t.clientX-n.left;var s=t.clientY-n.top;ft(r,s)}}function at(t,n){if(i==0){var r=e.getBoundingClientRect();var s=t-r.left;var o=n-r.top;ft(s,o)}}function ft(e,t){if(u=="play"){if(e>h+p&&s-e>p){if(t>p&&o-t>p){var n=Math.floor((e-h-p)/a);var r=Math.floor((t-p)/a);var f=new gt(n,r);if(f.getIndex(m)!=-1)return;if(S&&N>0&&f.getDistance(m[0])>y&&_>500){if(f.getIndex(d)==-1){N--;d.push(f)}}else if(T&&C>0&&f.getDistance(m[0])>y){if(f.getIndex(v)==-1){C--;v.push(f)}}else if(x){var l=f.getIndex(d);if(l!=-1){d.splice(l,1);N++}else{l=f.getIndex(v);if(l!=-1){v.splice(l,1);C++}}}}}}for(var c=0;c<et.length;c++){if(e>et[c].x&&e<et[c].x+et[c].width&&t>et[c].y&&t<et[c].y+et[c].height&&i==0){i=5;if(et[c].index!=0)et[c].select();et[c].onClick()}}}function lt(t){var i=e.getBoundingClientRect();n=t.clientX-i.left;r=t.clientY-i.top}function ct(){this.hold=0;this.lStickX=0;this.lStickY=0;this.rStickX=0;this.rStickY=0;this.gyroX=0;this.gyroY=0;this.gyroZ=0;this.angleX=0;this.angleY=0;this.angleZ=0;this.accX=0;this.accY=0;this.accZ=0;this.dirXx=1;this.dirXy=0;this.dirXz=0;this.dirYx=0;this.dirYy=1;this.dirYz=0;this.dirZx=0;this.dirZy=0;this.dirZz=1;this.tpTouch=0;this.tpValidity=0;this.contentX=0;this.contentY=0}function ht(e,n,r){t.save();t.beginPath();t.arc(e,n,r,0,2*Math.PI,false);t.fillStyle="green";t.fill();t.lineWidth=5;t.strokeStyle="#003300";t.stroke();t.restore()}function pt(e){var t=e%1e3;if(t<10)t="00"+t;else if(t<100)t="0"+t;var n=Math.floor(e/1e3)%60;if(n<10)n="0"+n;var r=Math.floor(e/1e3/60);var i=e==D?"+":"";return r+":"+n+"."+t+i}function dt(e){var t=Math.floor(e/1e3)%60;if(t<10)t="0"+t;var n=Math.floor(e/1e3/60);var r=e==D?"+":"";return n+(false?" ":":")+t+r}function vt(){t.save();t.strokeStyle="#9ec806";t.lineWidth=.5;for(var e=0;e<s/a*4;e++){t.beginPath();t.moveTo(e*(a/4),0);t.lineTo(e*(a/4),o);t.stroke()}for(var e=0;e<o/a*4;e++){t.beginPath();t.moveTo(0,e*(a/4));t.lineTo(s,e*(a/4));t.stroke()}t.restore()}function mt(){if(j){F=38;I=40;R=39;q=37}else{F=39;I=37;R=40;q=38}}function gt(e,t){this.x=e;if(this.x<0)this.x=l-1;else if(this.x>l-1)this.x=0;this.y=t;if(this.y<0)this.y=c-1;else if(this.y>c-1)this.y=0}function yt(e,t,n,r,i,s,o,u){this.x=e;this.y=t;this.height=r;this.width=n;this.selected=s;this.onClick=i;this.index=o;this.symbol=u;this.padding=f/2}function bt(e,t){this.message=e;this.duration=t}function wt(e,t,n,r){this.label=e;this.selections=t;this.selected=n;this.y=r;var i=this;this.controlButtons=[new yt(12*a,c*a*this.y-f,X/2,X/2,function(){i.decrease()},true,0,"-"),new yt(28.5*a,c*a*this.y-f,X/2,X/2,function(){i.increase()},true,0,"+")];for(var s=0;s<this.controlButtons.length;s++){Q.push(this.controlButtons[s])}}var e=$("#canvas")[0];var t=e.getContext("2d");e.addEventListener("click",ut,false);var n=0;var r=0;var i=0;e.height=560;e.width=1240;var s=$("#canvas").width();var o=$("#canvas").height();var u;var a=28;var f=a/4;var l=38;var c=20;var h=23*f;var p=(o-c*a)/2;var d=new Array;var v=new Array;var m=new Array;m.push(new gt(5,5));var g=new Array;var y=2;var b=5;var w=true;var E=false;var S=true;var x=false;var T=false;var N=10;var C=10;var k=5;var L=0;var A=1;var O=0;var M;var _;var D=999999;var P=99;var H=15e3;var B=0;var j=true;var F,I,q,R;mt();var U=true;var z=false;var W=false;var X=14*f;var V=4*f;var J=true;var K=[new yt(V,c*a*.475-X/2,X,X,function(){S=true;T=false;x=false},S,1,""),new yt(V,c*a*.725-X/2,X,X,function(){S=false;T=false;x=true},x,1,""),new yt(V,c*a*.225-X/2,X,X,function(){S=false;T=true;x=false},x,1,"")];var Q=[new yt(7*a,(c-2.5)*a-X/2,X*3,X,function(){it()},true,0,"Play"),new yt(25*a,(c-2.5)*a-X/2,X*3,X,function(){i=10;u="howto"},true,0,""),new yt(37*a,c*a*.675-X/2,X/2,X/2,function(){J=!J;U=true},true,0,""),new yt((l-4.5)*a,c*a*.3,X,X,function(){j=true;mt();U=true},j,1,""),new yt((l+1)*a,c*a*.3,X,X,function(){j=false;mt();U=true},!j,1,"")];var G=[new yt(f*66,f*45,X*2,X*.5,function(){it()},true,0,"Again"),new yt(f*106,f*45,X*2,X*.5,function(){st()},true,0,"Menu")];var Y=[new yt(16*a,(c-1.5)*a-X/2,X*3,X*.75,function(){st()},true,0,"Back")];var Z=[new wt("Safe Zone",[0,1,2,3,4],2,.2),new wt("Initial Speed",["Slow","Med","Fast"],1,.4),new wt("Initial Ammo",["Low","Med","High"],1,.6)];var et=Q;var tt=new Array;nt();$(document).keydown(function(e){if(u=="play"){var t=e.which;if(t==q){if(m[0].y!=m[1].y){A=-1;O=0}}else if(t==F){if(m[0].x!=m[1].x){A=0;O=-1}}else if(t==R){if(m[0].y!=m[1].y){A=1;O=0}}else if(t==I){if(m[0].x!=m[1].x){A=0;O=1}}if(t==13){}}});gt.prototype.getIndex=function(e){for(var t=0;t<e.length;t++){if(e[t].x==this.x&&e[t].y==this.y)return t}return-1};gt.prototype.getDistance=function(e){if(this.x==e.x&&this.y==e.y)return 0;var t=Math.ceil(l/2);var n=Math.ceil(c/2);var r=Math.abs(this.x-e.x);if(r>t){r=t+(t-r)}var i=Math.abs(this.y-e.y);if(i>n){i=n+(n-i)}return Math.max(r,i)};yt.prototype.draw=function(){t.save();t.fillStyle="black";t.textAlign="center";var e=this.symbol.length<=1?1.75:.4;t.font=""+Math.floor(this.width*e)+"px c64_basicregular";t.fillText(this.symbol,this.x+this.padding+this.width*.5,this.y+this.padding+this.height*.2+this.height*.5);if(this.selected||this.index==0){t.strokeStyle="black";t.lineWidth=f;t.strokeRect(this.x-this.padding,this.y-this.padding,this.width+2*this.padding,this.height+2*this.padding)}t.restore()};yt.prototype.select=function(){for(var e=0;e<et.length;e++){et[e].selected=et[e]==this}};wt.prototype.decrease=function(){if(this.selected>0){this.selected--;U=true}};wt.prototype.increase=function(){if(this.selected<this.selections.length-1){this.selected++;U=true}};wt.prototype.draw=function(){for(var e=0;e<this.controlButtons.length;e++){this.controlButtons[e].draw()}t.save();t.fillStyle="black";t.font=""+2*a+"px c64_basicregular";t.textAlign="left";t.fillText(this.label,4*f,c*a*this.y+a);t.textAlign="center";var n=2*a;t.font=""+n+"px c64_basicregular";var r=10*a/(this.selections.length-1);var i=16*a;for(var e=0;e<this.selections.length;e++){t.save();if(e==this.selected){var s=t.measureText(this.selections[e]).width;t.fillRect(i+e*r-s/2-f/2,c*a*this.y+n/2+f,s,f)}t.fillText(this.selections[e],i+e*r,c*a*this.y+n/2);t.restore()}t.restore()}})